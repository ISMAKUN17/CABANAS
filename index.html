<html><head><base href="." />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Reservas de Cabañas</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
body {
    background-color: #f8f9fa;
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
}

.container {
    max-width: 1200px;
}

.page-header {
    background: linear-gradient(135deg, #0d6efd 0%, #0099ff 100%);
    padding: 2rem;
    border-radius: 15px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 20px rgba(13, 110, 253, 0.15);
}

.page-header h2 {
    color: white;
    margin: 0;
    font-weight: 600;
}

.search-box {
    background: white;
    border-radius: 30px;
    padding: 0.5rem 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    max-width: 300px;
}

.search-box input {
    border: none;
    outline: none;
    width: 100%;
    padding: 0.5rem;
    font-size: 0.9rem;
}

.search-box i {
    color: #0d6efd;
}

.floating-button {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 65px;
    height: 65px;
    border-radius: 50%;
    background: linear-gradient(135deg, #0d6efd 0%, #0099ff 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(13, 110, 253, 0.3);
    transition: all 0.3s ease;
}

.floating-button:hover {
    transform: translateY(-5px) rotate(90deg);
    box-shadow: 0 6px 25px rgba(13, 110, 253, 0.4);
}

.table-responsive {
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(0,0,0,0.05);
    background: white;
    padding: 1rem;
}

.table {
    margin: 0;
}

.table th {
    background-color: #f8f9fa;
    border-bottom: 2px solid #e9ecef;
    color: #495057;
    font-weight: 600;
    padding: 1rem;
}

.table td {
    padding: 1rem;
    vertical-align: middle;
}

.badge-cabin {
    padding: 8px 15px;
    border-radius: 30px;
    font-weight: 500;
    font-size: 0.85rem;
    transition: all 0.3s ease;
}

.badge-wonderpool {
    background: #e3f2fd;
    color: #0d6efd;
}

.badge-piscina {
    background: #e8f5e9;
    color: #2e7d32;
}

.badge-playa {
    background: #fff3e0;
    color: #ef6c00;
}

.badge-vip {
    background: #fce4ec;
    color: #c2185b;
}

.location-info {
    background: white;
    padding: 1rem;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.location-info .badge {
    margin: 0.3rem;
    font-size: 0.9rem;
}

.modal-content {
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.modal-header {
    background: linear-gradient(135deg, #0d6efd 0%, #0099ff 100%);
    color: white;
    border-radius: 15px 15px 0 0;
}

.modal-title {
    font-weight: 600;
}

.btn-close {
    filter: brightness(0) invert(1);
}

.form-control, .form-select {
    border-radius: 8px;
    border: 1px solid #dee2e6;
    padding: 0.75rem;
}

.form-control:focus, .form-select:focus {
    box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
}

.action-buttons .btn {
    border-radius: 8px;
    padding: 0.5rem 1rem;
    transition: all 0.3s ease;
}

.action-buttons .btn:hover {
    transform: translateY(-2px);
}

.table-hover tbody tr {
    transition: all 0.3s ease;
}

.table-hover tbody tr:hover {
    background-color: #f8f9fa;
    transform: scale(1.01);
}

.cabin-status {
    width: 45px;
    height: 45px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.cabin-status:hover {
    transform: scale(1.1);
}

.cabin-status.available {
    background-color: #e8f5e9;
    color: #2e7d32;
    border: 2px solid #81c784;
}

.cabin-status.occupied {
    background-color: #ffebee;
    color: #c62828;
    border: 2px solid #e57373;
}

.cabin-section {
    background: white;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

/* Add print layout styles */
@media print {
    body * {
        visibility: hidden;
    }
    
    #printArea, #printArea * {
        visibility: visible;
    }
    
    #printArea {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
    }
    
    .print-page {
        page-break-after: always;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }
    
    .cabin-label {
        page-break-inside: avoid;
        height: 48vh;
        border: 1px dashed #ccc;
        margin: 1vh 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
    }
    
    .cabin-number {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .location-text {
        font-size: 18px;
        color: #666;
        margin-bottom: 15px;
    }
    
    .guest-name {
        font-size: 36px; /* Increased from previous size */
        font-weight: bold;
        text-align: center;
        margin: 15px 0;
    }
    
    .room-number {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 14px;
        color: #666;
    }
    
    @page {
        size: letter;
        margin: 0.5cm;
    }
}
</style>
</head>
<body>

<div class="container mt-4">
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-center">
            <h2><i class="fas fa-hotel me-2"></i>Sistema de Reservas de Cabañas</h2>
            <div class="d-flex gap-3 align-items-center">
                <div class="search-box">
                    <i class="fas fa-search me-2"></i>
                    <input type="text" id="searchInput" placeholder="Buscar reserva..." onkeyup="filterReservations()">
                </div>
                <button class="btn btn-light" onclick="openConsultationModal()">
                    <i class="fas fa-calendar-check me-2"></i>Consultar Disponibilidad
                </button>
                <button class="btn btn-light" onclick="printCabinLabels()">
                    <i class="fas fa-print me-2"></i>Imprimir Etiquetas
                </button>
            </div>
        </div>
    </div>
    
    <div class="location-info">
        <span class="badge badge-cabin badge-wonderpool"><i class="fas fa-swimming-pool me-2"></i>Cabañas 1-20: Wonderpool</span>
        <span class="badge badge-cabin badge-piscina"><i class="fas fa-water me-2"></i>Cabañas 21-26: Piscina Principal</span>
        <span class="badge badge-cabin badge-playa"><i class="fas fa-umbrella-beach me-2"></i>Cabañas 27-31: Playa Regular</span>
        <span class="badge badge-cabin badge-vip"><i class="fas fa-star me-2"></i>Cabañas 32-38: Playa VIP</span>
    </div>

    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th><i class="far fa-calendar me-2"></i>Fecha</th>
                    <th><i class="fas fa-door-closed me-2"></i>Habitación</th>
                    <th><i class="fas fa-user me-2"></i>Huésped</th>
                    <th><i class="fas fa-home me-2"></i>Cabaña</th>
                    <th><i class="fas fa-user-tie me-2"></i>Vendedor</th>
                    <th><i class="fas fa-comments me-2"></i>Comentarios</th>
                    <th><i class="fas fa-cog me-2"></i>Acciones</th>
                </tr>
            </thead>
            <tbody id="reservationsList">
                <!-- Las reservas se cargarán aquí dinámicamente -->
            </tbody>
        </table>
    </div>

    <div class="floating-button" onclick="openNewReservationModal()">
        <i class="fas fa-plus"></i>
    </div>
</div>

<!-- Hidden print area -->
<div id="printArea" style="display: none;"></div>

<!-- Modal para nueva reserva -->
<div class="modal fade" id="reservationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus-circle me-2"></i>Nueva Reserva</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="reservationForm">
                    <div class="mb-3">
                        <label class="form-label"><i class="far fa-calendar me-2"></i>Fecha de Reserva</label>
                        <input type="date" class="form-control" id="reservationDate" onchange="updateAvailableCabins()" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-door-closed me-2"></i>Número de Habitación</label>
                        <input type="number" class="form-control" id="roomNumber" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-user me-2"></i>Nombre del Huésped</label>
                        <input type="text" class="form-control" id="guestName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-home me-2"></i>Número de Cabaña</label>
                        <select class="form-select" id="cabinNumber" required>
                            <option value="">Seleccionar cabaña</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-user-tie me-2"></i>Vendedor</label>
                        <input type="text" class="form-control" id="seller" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-comments me-2"></i>Comentarios</label>
                        <textarea class="form-control" id="comments" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="saveReservation()">
                    <i class="fas fa-save me-2"></i>Guardar Reserva
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para consulta de disponibilidad -->
<div class="modal fade" id="consultationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-calendar-check me-2"></i>Consulta de Disponibilidad</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <label class="form-label"><i class="far fa-calendar me-2"></i>Seleccione una fecha</label>
                    <input type="date" class="form-control" id="consultationDate" onchange="updateConsultationView()">
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="cabin-section">
                            <h6 class="text-primary"><i class="fas fa-swimming-pool me-2"></i>Wonderpool (1-20)</h6>
                            <div id="wonderpoolStatus" class="d-flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="cabin-section">
                            <h6 class="text-success"><i class="fas fa-water me-2"></i>Piscina Principal (21-26)</h6>
                            <div id="piscinaStatus" class="d-flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="cabin-section">
                            <h6 class="text-warning"><i class="fas fa-umbrella-beach me-2"></i>Playa Regular (27-31)</h6>
                            <div id="playaStatus" class="d-flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="cabin-section">
                            <h6 class="text-danger"><i class="fas fa-star me-2"></i>Playa VIP (32-38)</h6>
                            <div id="vipStatus" class="d-flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// El resto del código JavaScript permanece igual que en la versión anterior
let reservations = [];
const modal = new bootstrap.Modal(document.getElementById('reservationModal'));
const consultationModal = new bootstrap.Modal(document.getElementById('consultationModal'));

function getCabinLocation(cabinNumber) {
    if (cabinNumber >= 1 && cabinNumber <= 20) return 'wonderpool';
    if (cabinNumber >= 21 && cabinNumber <= 26) return 'piscina';
    if (cabinNumber >= 27 && cabinNumber <= 31) return 'playa';
    if (cabinNumber >= 32 && cabinNumber <= 38) return 'vip';
    return '';
}

function updateAvailableCabins() {
    const selectedDate = document.getElementById('reservationDate').value;
    const reservedCabins = reservations
        .filter(r => r.reservationDate === selectedDate)
        .map(r => r.cabinNumber);

    const select = document.getElementById('cabinNumber');
    select.innerHTML = '<option value="">Seleccionar cabaña</option>';
    
    for(let i = 1; i <= 38; i++) {
        if (!reservedCabins.includes(i.toString())) {
            const location = getCabinLocation(i);
            let locationText = '';
            switch(location) {
                case 'wonderpool': locationText = '(Wonderpool)'; break;
                case 'piscina': locationText = '(Piscina Principal)'; break;
                case 'playa': locationText = '(Playa Regular)'; break;
                case 'vip': locationText = '(Playa VIP)'; break;
            }
            select.innerHTML += `<option value="${i}">Cabaña ${i} ${locationText}</option>`;
        }
    }
}

function openNewReservationModal() {
    document.getElementById('reservationForm').reset();
    updateAvailableCabins();
    modal.show();
}

function saveReservation() {
    const form = document.getElementById('reservationForm');
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    const selectedDate = document.getElementById('reservationDate').value;
    // Crear una fecha con la zona horaria local
    const date = new Date(selectedDate);
    date.setMinutes(date.getMinutes() + date.getTimezoneOffset());
    
    const reservation = {
        id: Date.now(),
        reservationDate: date.toISOString().split('T')[0], // Formato YYYY-MM-DD
        roomNumber: document.getElementById('roomNumber').value,
        guestName: document.getElementById('guestName').value,
        cabinNumber: document.getElementById('cabinNumber').value,
        seller: document.getElementById('seller').value,
        comments: document.getElementById('comments').value
    };

    reservations.push(reservation);
    updateReservationsList();
    modal.hide();
}

function deleteReservation(id) {
    if (confirm('¿Está seguro de eliminar esta reserva?')) {
        reservations = reservations.filter(r => r.id !== id);
        updateReservationsList();
    }
}

function filterReservations() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const filteredReservations = reservations.filter(reservation => 
        reservation.guestName.toLowerCase().includes(searchTerm) ||
        reservation.cabinNumber.toString().includes(searchTerm) ||
        reservation.seller.toLowerCase().includes(searchTerm) ||
        reservation.roomNumber.toString().includes(searchTerm)
    );
    updateReservationsList(filteredReservations);
}

function formatDate(dateString) {
    const date = new Date(dateString);
    // Ajustar la zona horaria local
    date.setMinutes(date.getMinutes() + date.getTimezoneOffset());
    const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
    return date.toLocaleDateString('es-ES', options);
}

function updateReservationsList(reservationsToShow = reservations) {
    const list = document.getElementById('reservationsList');
    list.innerHTML = '';

    // Sort reservations by date
    const sortedReservations = [...reservationsToShow].sort((a, b) => {
        // Convert dates to timestamps for comparison
        const dateA = new Date(a.reservationDate).getTime();
        const dateB = new Date(b.reservationDate).getTime();
        return dateA - dateB;
    });

    sortedReservations.forEach(reservation => {
        const cabinLocation = getCabinLocation(reservation.cabinNumber);
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${formatDate(reservation.reservationDate)}</td>
            <td>${reservation.roomNumber}</td>
            <td>${reservation.guestName}</td>
            <td><span class="badge badge-cabin badge-${cabinLocation}">Cabaña ${reservation.cabinNumber}</span></td>
            <td>${reservation.seller}</td>
            <td>${reservation.comments || '-'}</td>
            <td class="action-buttons">
                <button class="btn btn-outline-danger btn-sm" onclick="deleteReservation(${reservation.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        list.appendChild(row);
    });
}

// Consultar disponibilidad modal functions
function openConsultationModal() {
    document.getElementById('consultationDate').value = new Date().toISOString().split('T')[0];
    updateConsultationView();
    consultationModal.show();
}

function updateConsultationView() {
    const selectedDate = document.getElementById('consultationDate').value;
    const reservedCabins = reservations
        .filter(r => r.reservationDate === selectedDate)
        .map(r => parseInt(r.cabinNumber));

    updateCabinSection('wonderpoolStatus', 1, 20, reservedCabins);
    updateCabinSection('piscinaStatus', 21, 26, reservedCabins);
    updateCabinSection('playaStatus', 27, 31, reservedCabins);
    updateCabinSection('vipStatus', 32, 38, reservedCabins);
}

function updateCabinSection(sectionId, start, end, reservedCabins) {
    const section = document.getElementById(sectionId);
    section.innerHTML = '';
    
    for(let i = start; i <= end; i++) {
        const isOccupied = reservedCabins.includes(i);
        const cabin = document.createElement('div');
        cabin.className = `cabin-status ${isOccupied ? 'occupied' : 'available'}`;
        cabin.innerHTML = i;
        
        if(isOccupied) {
            const reservation = reservations.find(r => parseInt(r.cabinNumber) === i);
            cabin.title = `Ocupada por: ${reservation.guestName}`;
        } else {
            cabin.title = 'Disponible';
        }
        
        section.appendChild(cabin);
    }
}

// Funciones para imprimir etiquetas de cabañas
function printCabinLabels() {
    const selectedDate = prompt("Ingrese la fecha para imprimir (YYYY-MM-DD):", new Date().toISOString().split('T')[0]);
    if (!selectedDate) return;

    const dateReservations = reservations.filter(r => r.reservationDate === selectedDate)
        .sort((a, b) => parseInt(a.cabinNumber) - parseInt(b.cabinNumber));

    if (dateReservations.length === 0) {
        alert("No hay reservas para la fecha seleccionada");
        return;
    }

    const printArea = document.getElementById('printArea');
    printArea.innerHTML = '';
    printArea.style.display = 'block';

    // Crear etiquetas
    for (let i = 0; i < dateReservations.length; i += 2) {
        const pageDiv = document.createElement('div');
        pageDiv.className = 'print-page';

        // Primera cabaña en la página
        const cabin1 = createCabinLabel(dateReservations[i]);
        pageDiv.appendChild(cabin1);

        // Segunda cabaña en la página (si existe)
        if (i + 1 < dateReservations.length) {
            const cabin2 = createCabinLabel(dateReservations[i + 1]);
            pageDiv.appendChild(cabin2);
        }

        printArea.appendChild(pageDiv);
    }

    // Iniciar impresión
    setTimeout(() => {
        window.print();
        printArea.style.display = 'none';
    }, 100);
}

function createCabinLabel(reservation) {
    const cabinDiv = document.createElement('div');
    cabinDiv.className = 'cabin-label';
    
    const location = getCabinLocation(parseInt(reservation.cabinNumber));
    let locationText = '';
    switch(location) {
        case 'wonderpool': locationText = 'Wonderpool'; break;
        case 'piscina': locationText = 'Piscina Principal'; break;
        case 'playa': locationText = 'Playa Regular'; break;
        case 'vip': locationText = 'Playa VIP'; break;
    }

    cabinDiv.innerHTML = `
        <div class="cabin-number">Cabaña ${reservation.cabinNumber}</div>
        <div class="location-text">${locationText}</div>
        <div class="guest-name">${reservation.guestName}</div>
        <div class="room-number">Habitación ${reservation.roomNumber}</div>
    `;

    return cabinDiv;
}

// Inicializar con algunas reservas de ejemplo
reservations = [
    {
        id: 1,
        reservationDate: "2024-02-01",
        roomNumber: "101",
        guestName: "Juan Pérez",
        cabinNumber: "1",
        seller: "Ana Vendedora",
        comments: "Cliente VIP, solicita vista al lago"
    },
    {
        id: 2,
        reservationDate: "2024-02-10",
        roomNumber: "204",
        guestName: "María García",
        cabinNumber: "25",
        seller: "Carlos Ventas",
        comments: "Área de piscina principal"
    }
];

updateReservationsList();
</script>

</body>
</html>
